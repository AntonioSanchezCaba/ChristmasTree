<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üíß Water Tank System</title>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,600;0,9..40,700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #090a0f;
            --bg-secondary: #1b2735;
            --bg-card: rgba(255, 255, 255, 0.04);
            --bg-card-hover: rgba(255, 255, 255, 0.07);
            --border-subtle: rgba(255, 255, 255, 0.08);
            --border-active: rgba(102, 126, 234, 0.4);
            --accent-primary: #667eea;
            --accent-secondary: #764ba2;
            --accent-cyan: #4facfe;
            --accent-success: #00e676;
            --accent-warning: #ffab40;
            --accent-danger: #ff5252;
            --text-primary: rgba(255, 255, 255, 0.95);
            --text-secondary: rgba(255, 255, 255, 0.6);
            --text-muted: rgba(255, 255, 255, 0.35);
            --supply-color: #4facfe;
            --supply-glow: rgba(79, 172, 254, 0.3);
            --consumption-color: #667eea;
            --consumption-glow: rgba(102, 126, 234, 0.3);
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --radius-xl: 20px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'DM Sans', 'Segoe UI', sans-serif;
            background: radial-gradient(ellipse at bottom, var(--bg-secondary) 0%, var(--bg-primary) 100%);
            min-height: 100vh;
            color: var(--text-primary);
            padding-top: 50px;
            overflow-x: hidden;
        }

        /* ===== TOP NAVIGATION BAR (matches index.html) ===== */
        .top-nav {
            position: fixed;
            top: 0; left: 0; right: 0;
            height: 50px;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 30px;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }
        .top-nav .nav-links { display: flex; align-items: center; }
        .top-nav a {
            color: white; text-decoration: none; font-size: 16px;
            font-weight: 500; padding: 10px 20px; border-radius: 8px; transition: all 0.3s;
        }
        .top-nav a:hover { background: rgba(255,255,255,0.1); }
        .top-nav a.active { background: rgba(102, 126, 234, 0.3); border-bottom: 2px solid #667eea; }
        .top-nav .separator { color: rgba(255,255,255,0.3); margin: 0 10px; }
        .nav-auth { display: flex; align-items: center; gap: 15px; }
        .nav-auth-buttons { display: flex; align-items: center; gap: 10px; }
        .nav-auth-buttons a { padding: 8px 16px; font-size: 14px; }
        .nav-auth-buttons .login-btn { background: transparent; border: 1px solid rgba(255,255,255,0.3); }
        .nav-auth-buttons .login-btn:hover { background: rgba(255,255,255,0.1); border-color: white; }
        .nav-user {
            display: flex; align-items: center; gap: 10px; color: white;
            cursor: pointer; padding: 8px 12px; border-radius: 8px; transition: all 0.3s;
        }
        .nav-user:hover { background: rgba(255,255,255,0.1); }
        .nav-user-avatar {
            width: 32px; height: 32px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%; display: flex; align-items: center;
            justify-content: center; font-size: 14px;
        }
        .nav-user-info { display: flex; flex-direction: column; }
        .nav-user-name { font-size: 14px; font-weight: 500; }
        .nav-user-dropdown { font-size: 12px; opacity: 0.7; }
        .nav-dropdown { position: relative; }
        .nav-dropdown-menu {
            position: absolute; top: 100%; right: 0; margin-top: 8px;
            background: white; border-radius: 8px; box-shadow: 0 4px 20px rgba(0,0,0,0.2);
            min-width: 200px; display: none; overflow: hidden;
        }
        .nav-dropdown-menu.show { display: block; }
        .nav-dropdown-menu a, .nav-dropdown-menu button {
            display: block; width: 100%; padding: 12px 16px; color: #333;
            text-decoration: none; font-size: 14px; border: none; background: none;
            text-align: left; cursor: pointer; transition: background 0.2s;
        }
        .nav-dropdown-menu a:hover, .nav-dropdown-menu button:hover { background: #f5f5f5; }
        .nav-dropdown-menu .logout-btn { color: #dc3545; border-top: 1px solid #eee; }

        /* ===== DASHBOARD LAYOUT ===== */
        .dashboard {
            max-width: 1400px;
            margin: 0 auto;
            padding: 24px 28px 40px;
        }

        /* Dashboard Header */
        .dash-header {
            margin-bottom: 28px;
            animation: fadeUp 0.6s ease-out;
        }
        .dash-header h1 {
            font-size: 28px;
            font-weight: 700;
            letter-spacing: -0.5px;
            background: linear-gradient(135deg, var(--supply-color) 0%, var(--accent-primary) 50%, var(--accent-secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .dash-header p {
            color: var(--text-secondary);
            font-size: 14px;
            margin-top: 4px;
            font-weight: 400;
        }
        .dash-header-row {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
        }
        .dash-timestamp {
            font-size: 12px;
            color: var(--text-muted);
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .dash-timestamp .live-dot {
            width: 6px; height: 6px;
            background: var(--accent-success);
            border-radius: 50%;
            animation: pulse-dot 2s ease-in-out infinite;
        }

        /* ===== STAT CARDS ROW ===== */
        .stats-row {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }
        .stat-card {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-md);
            padding: 18px 20px;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
            animation: fadeUp 0.6s ease-out both;
        }
        .stat-card:nth-child(1) { animation-delay: 0.05s; }
        .stat-card:nth-child(2) { animation-delay: 0.1s; }
        .stat-card:nth-child(3) { animation-delay: 0.15s; }
        .stat-card:nth-child(4) { animation-delay: 0.2s; }
        .stat-card:hover {
            background: var(--bg-card-hover);
            border-color: var(--border-active);
            transform: translateY(-2px);
        }
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0;
            height: 2px;
            border-radius: 2px 2px 0 0;
        }
        .stat-card.supply::before { background: linear-gradient(90deg, var(--supply-color), var(--accent-cyan)); }
        .stat-card.consumption::before { background: linear-gradient(90deg, var(--consumption-color), var(--accent-secondary)); }
        .stat-card.flow::before { background: linear-gradient(90deg, var(--accent-success), #69f0ae); }
        .stat-card.alert::before { background: linear-gradient(90deg, var(--accent-warning), #ffd740); }
        .stat-label {
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            color: var(--text-muted);
            margin-bottom: 8px;
        }
        .stat-value {
            font-size: 26px;
            font-weight: 700;
            letter-spacing: -0.5px;
            line-height: 1;
        }
        .stat-card.supply .stat-value { color: var(--supply-color); }
        .stat-card.consumption .stat-value { color: var(--consumption-color); }
        .stat-card.flow .stat-value { color: var(--accent-success); }
        .stat-card.alert .stat-value { color: var(--accent-warning); }
        .stat-value span { font-size: 14px; font-weight: 500; opacity: 0.7; }
        .stat-change {
            display: inline-flex;
            align-items: center;
            gap: 3px;
            font-size: 11px;
            font-weight: 600;
            margin-top: 6px;
            padding: 2px 6px;
            border-radius: 4px;
        }
        .stat-change.up { color: var(--accent-success); background: rgba(0, 230, 118, 0.1); }
        .stat-change.down { color: var(--accent-danger); background: rgba(255, 82, 82, 0.1); }
        .stat-change.neutral { color: var(--text-muted); background: rgba(255,255,255,0.05); }

        /* ===== TANKS SECTION ===== */
        .tanks-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 24px;
        }
        .tank-card {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-lg);
            padding: 24px;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
            animation: fadeUp 0.7s ease-out both;
        }
        .tank-card:nth-child(1) { animation-delay: 0.15s; }
        .tank-card:nth-child(2) { animation-delay: 0.25s; }
        .tank-card:hover {
            border-color: var(--border-active);
        }
        .tank-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .tank-card-title {
            font-size: 16px;
            font-weight: 600;
        }
        .tank-card-badge {
            font-size: 11px;
            font-weight: 600;
            padding: 4px 10px;
            border-radius: 20px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .tank-card.supply .tank-card-badge {
            background: rgba(79, 172, 254, 0.15);
            color: var(--supply-color);
        }
        .tank-card.consumption .tank-card-badge {
            background: rgba(102, 126, 234, 0.15);
            color: var(--consumption-color);
        }

        /* ===== TANK VISUALIZATION ===== */
        .tank-visual-area {
            display: flex;
            align-items: flex-end;
            justify-content: center;
            gap: 32px;
            padding: 10px 0 20px;
        }
        .tank-container {
            position: relative;
            width: 140px;
            height: 220px;
        }
        .tank-body {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 200px;
            border: 2px solid rgba(255,255,255,0.15);
            border-radius: 0 0 14px 14px;
            overflow: hidden;
            background: rgba(0,0,0,0.3);
        }
        /* Tank top cap */
        .tank-cap {
            position: absolute;
            top: 0;
            left: -2px;
            right: -2px;
            height: 22px;
            background: rgba(255,255,255,0.08);
            border: 2px solid rgba(255,255,255,0.15);
            border-radius: 10px 10px 0 0;
            border-bottom: none;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .tank-cap-pipe {
            width: 20px;
            height: 8px;
            background: rgba(255,255,255,0.12);
            border-radius: 2px;
            position: absolute;
            top: -8px;
        }
        /* Water fill */
        .tank-water {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            border-radius: 0 0 12px 12px;
            transition: height 1.5s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .tank-card.supply .tank-water {
            background: linear-gradient(180deg,
                rgba(79, 172, 254, 0.7) 0%,
                rgba(79, 172, 254, 0.4) 60%,
                rgba(0, 242, 254, 0.5) 100%
            );
        }
        .tank-card.consumption .tank-water {
            background: linear-gradient(180deg,
                rgba(102, 126, 234, 0.7) 0%,
                rgba(102, 126, 234, 0.4) 60%,
                rgba(118, 75, 162, 0.5) 100%
            );
        }
        /* Water surface wave */
        .tank-water::before {
            content: '';
            position: absolute;
            top: -6px;
            left: -10%;
            width: 120%;
            height: 12px;
            border-radius: 50%;
        }
        .tank-card.supply .tank-water::before {
            background: radial-gradient(ellipse, rgba(79,172,254,0.6) 0%, transparent 70%);
            animation: wave-supply 3s ease-in-out infinite;
        }
        .tank-card.consumption .tank-water::before {
            background: radial-gradient(ellipse, rgba(102,126,234,0.6) 0%, transparent 70%);
            animation: wave-consumption 3.5s ease-in-out infinite;
        }
        /* Water bubbles */
        .bubble {
            position: absolute;
            border-radius: 50%;
            opacity: 0;
            animation: bubbleRise 4s ease-in infinite;
        }
        .tank-card.supply .bubble { background: rgba(79, 172, 254, 0.4); }
        .tank-card.consumption .bubble { background: rgba(102, 126, 234, 0.4); }

        /* Scale marks */
        .tank-scale {
            position: absolute;
            top: 0; bottom: 0;
            right: -28px;
            width: 24px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 4px 0;
        }
        .scale-mark {
            font-size: 9px;
            color: var(--text-muted);
            text-align: left;
            position: relative;
        }
        .scale-mark::before {
            content: '';
            position: absolute;
            left: -8px;
            top: 50%;
            width: 5px;
            height: 1px;
            background: rgba(255,255,255,0.15);
        }

        /* Tank percent label */
        .tank-percent {
            font-size: 42px;
            font-weight: 700;
            letter-spacing: -2px;
            line-height: 1;
        }
        .tank-card.supply .tank-percent { color: var(--supply-color); }
        .tank-card.consumption .tank-percent { color: var(--consumption-color); }
        .tank-percent span {
            font-size: 18px;
            font-weight: 500;
            opacity: 0.6;
        }
        .tank-info-stack {
            display: flex;
            flex-direction: column;
            gap: 10px;
            min-width: 120px;
        }
        .tank-detail {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }
        .tank-detail-label {
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.7px;
            color: var(--text-muted);
        }
        .tank-detail-value {
            font-size: 15px;
            font-weight: 600;
            color: var(--text-primary);
        }
        .tank-status-bar {
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid var(--border-subtle);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .tank-status {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
            font-weight: 500;
        }
        .status-dot {
            width: 8px; height: 8px;
            border-radius: 50%;
        }
        .status-dot.online { background: var(--accent-success); box-shadow: 0 0 8px rgba(0,230,118,0.4); }
        .status-dot.warning { background: var(--accent-warning); box-shadow: 0 0 8px rgba(255,171,64,0.4); }
        .status-dot.offline { background: var(--accent-danger); box-shadow: 0 0 8px rgba(255,82,82,0.4); }
        .tank-updated {
            font-size: 11px;
            color: var(--text-muted);
        }

        /* ===== BOTTOM ROW: CHART + ACTIVITY LOG ===== */
        .bottom-row {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
        }
        .chart-card, .activity-card {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-lg);
            padding: 24px;
            animation: fadeUp 0.8s ease-out both;
        }
        .chart-card { animation-delay: 0.3s; }
        .activity-card { animation-delay: 0.35s; }
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .card-title {
            font-size: 15px;
            font-weight: 600;
        }
        .card-tabs {
            display: flex;
            gap: 4px;
            background: rgba(255,255,255,0.05);
            padding: 3px;
            border-radius: var(--radius-sm);
        }
        .card-tab {
            font-size: 11px;
            font-weight: 500;
            padding: 5px 12px;
            border-radius: 6px;
            cursor: pointer;
            color: var(--text-secondary);
            transition: all 0.2s;
            border: none;
            background: none;
        }
        .card-tab:hover { color: var(--text-primary); }
        .card-tab.active {
            background: rgba(102, 126, 234, 0.2);
            color: var(--accent-primary);
        }

        /* ===== SVG CHART ===== */
        .chart-area {
            width: 100%;
            height: 200px;
            position: relative;
        }
        .chart-area svg {
            width: 100%;
            height: 100%;
        }
        .chart-grid-line {
            stroke: rgba(255,255,255,0.06);
            stroke-width: 1;
        }
        .chart-label {
            fill: var(--text-muted);
            font-size: 10px;
            font-family: 'DM Sans', sans-serif;
        }
        .chart-line-supply {
            fill: none;
            stroke: var(--supply-color);
            stroke-width: 2;
            stroke-linecap: round;
            stroke-linejoin: round;
        }
        .chart-line-consumption {
            fill: none;
            stroke: var(--consumption-color);
            stroke-width: 2;
            stroke-linecap: round;
            stroke-linejoin: round;
        }
        .chart-area-supply {
            fill: url(#supplyGradient);
            opacity: 0.3;
        }
        .chart-area-consumption {
            fill: url(#consumptionGradient);
            opacity: 0.2;
        }
        .chart-dot {
            r: 3;
            stroke-width: 2;
            transition: r 0.2s;
            cursor: pointer;
        }
        .chart-dot:hover { r: 5; }
        .chart-dot.supply { fill: var(--bg-primary); stroke: var(--supply-color); }
        .chart-dot.consumption { fill: var(--bg-primary); stroke: var(--consumption-color); }
        .chart-legend {
            display: flex;
            gap: 20px;
            margin-top: 14px;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
            color: var(--text-secondary);
        }
        .legend-dot {
            width: 8px; height: 8px;
            border-radius: 50%;
        }
        .legend-dot.supply { background: var(--supply-color); }
        .legend-dot.consumption { background: var(--consumption-color); }

        /* ===== ACTIVITY LOG ===== */
        .activity-list {
            display: flex;
            flex-direction: column;
            gap: 0;
        }
        .activity-item {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 12px 0;
            border-bottom: 1px solid var(--border-subtle);
            transition: background 0.2s;
        }
        .activity-item:last-child { border-bottom: none; }
        .activity-icon {
            width: 32px; height: 32px;
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            flex-shrink: 0;
        }
        .activity-icon.fill { background: rgba(79, 172, 254, 0.12); }
        .activity-icon.drain { background: rgba(102, 126, 234, 0.12); }
        .activity-icon.alert { background: rgba(255, 171, 64, 0.12); }
        .activity-icon.system { background: rgba(0, 230, 118, 0.12); }
        .activity-text {
            flex: 1;
            font-size: 13px;
            color: var(--text-secondary);
            line-height: 1.4;
        }
        .activity-text strong { color: var(--text-primary); font-weight: 600; }
        .activity-time {
            font-size: 11px;
            color: var(--text-muted);
            flex-shrink: 0;
            margin-top: 2px;
        }

        /* ===== ANIMATIONS ===== */
        @keyframes fadeUp {
            from { opacity: 0; transform: translateY(16px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes pulse-dot {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.4; }
        }
        @keyframes wave-supply {
            0%, 100% { transform: translateX(-5%) scaleY(1); }
            50% { transform: translateX(5%) scaleY(1.4); }
        }
        @keyframes wave-consumption {
            0%, 100% { transform: translateX(3%) scaleY(1); }
            50% { transform: translateX(-3%) scaleY(1.3); }
        }
        @keyframes bubbleRise {
            0% { opacity: 0; transform: translateY(0) scale(0.5); }
            20% { opacity: 0.6; }
            100% { opacity: 0; transform: translateY(-180px) scale(1); }
        }
        @keyframes chart-draw {
            from { stroke-dashoffset: 1000; }
            to { stroke-dashoffset: 0; }
        }

        /* ===== RESPONSIVE ===== */
        @media (max-width: 1024px) {
            .stats-row { grid-template-columns: repeat(2, 1fr); }
            .bottom-row { grid-template-columns: 1fr; }
        }
        @media (max-width: 768px) {
            .dashboard { padding: 16px 14px 32px; }
            .tanks-section { grid-template-columns: 1fr; }
            .stats-row { grid-template-columns: repeat(2, 1fr); gap: 10px; }
            .tank-visual-area { flex-direction: column; align-items: center; }
            .tank-info-stack { align-items: center; text-align: center; }
            .top-nav { padding: 0 15px; }
            .top-nav a { padding: 6px 10px; font-size: 12px; }
            .top-nav .separator { margin: 0 5px; }
            .nav-user-info { display: none; }
            .nav-user-dropdown { display: none; }
            .stat-card { padding: 14px 16px; }
            .stat-value { font-size: 22px; }
            .dash-header h1 { font-size: 22px; }
        }
        @media (max-width: 480px) {
            .stats-row { grid-template-columns: 1fr 1fr; gap: 8px; }
            .stat-label { font-size: 10px; }
            .stat-value { font-size: 20px; }
            .tank-container { width: 120px; height: 180px; }
            .tank-body { height: 160px; }
            .tank-percent { font-size: 34px; }
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <nav class="top-nav">
        <div class="nav-links">
            <a href="index.html">üéÑ Christmas Tree</a>
            <span class="separator">|</span>
            <a href="water.html" class="active">üíß Water Tank System</a>
        </div>
        <div class="nav-auth">
            <div class="nav-auth-buttons" id="navAuthButtons" style="display: none;">
                <a href="index.html" class="login-btn">üîê Login</a>
            </div>
            <div class="nav-dropdown" id="navUserDropdown" style="display: none;">
                <div class="nav-user" onclick="toggleUserDropdown()">
                    <div class="nav-user-avatar">üë§</div>
                    <div class="nav-user-info">
                        <span class="nav-user-name" id="navUserName">User</span>
                    </div>
                    <span class="nav-user-dropdown">‚ñº</span>
                </div>
                <div class="nav-dropdown-menu" id="navDropdownMenu">
                    <a href="index.html">üéÑ Go to Tree Controls</a>
                    <button class="logout-btn" onclick="handleLogout()">üö™ Cerrar Sesi√≥n</button>
                </div>
            </div>
        </div>
    </nav>

    <div class="dashboard">
        <!-- Header -->
        <div class="dash-header">
            <div class="dash-header-row">
                <div>
                    <h1>üíß Water Tank System</h1>
                    <p>Real-time monitoring &amp; analytics</p>
                </div>
                <div class="dash-timestamp">
                    <span class="live-dot"></span>
                    <span id="liveTime">--</span>
                </div>
            </div>
        </div>

        <!-- Stats Row -->
        <div class="stats-row">
            <div class="stat-card supply">
                <div class="stat-label">Supply Level</div>
                <div class="stat-value" id="statSupply">78<span>%</span></div>
                <div class="stat-change up">‚ñ≤ 3% last hour</div>
            </div>
            <div class="stat-card consumption">
                <div class="stat-label">Consumption Level</div>
                <div class="stat-value" id="statConsumption">54<span>%</span></div>
                <div class="stat-change down">‚ñº 8% last hour</div>
            </div>
            <div class="stat-card flow">
                <div class="stat-label">Flow Rate</div>
                <div class="stat-value">2.4<span> L/min</span></div>
                <div class="stat-change neutral">‚óè Stable</div>
            </div>
            <div class="stat-card alert">
                <div class="stat-label">Daily Usage</div>
                <div class="stat-value">347<span> L</span></div>
                <div class="stat-change up">‚ñ≤ 12% vs avg</div>
            </div>
        </div>

        <!-- Tank Visualizations -->
        <div class="tanks-section">
            <!-- Supply Tank -->
            <div class="tank-card supply">
                <div class="tank-card-header">
                    <div class="tank-card-title">Supply Tank</div>
                    <div class="tank-card-badge">CISTERNA</div>
                </div>
                <div class="tank-visual-area">
                    <div class="tank-container">
                        <div class="tank-cap">
                            <div class="tank-cap-pipe"></div>
                        </div>
                        <div class="tank-body">
                            <div class="tank-water" id="supplyWater" style="height: 78%;">
                                <div class="bubble" style="width:6px;height:6px;left:20%;bottom:10%;animation-delay:0s;"></div>
                                <div class="bubble" style="width:4px;height:4px;left:55%;bottom:5%;animation-delay:1.2s;"></div>
                                <div class="bubble" style="width:5px;height:5px;left:75%;bottom:15%;animation-delay:2.5s;"></div>
                                <div class="bubble" style="width:3px;height:3px;left:40%;bottom:8%;animation-delay:3.8s;"></div>
                            </div>
                            <div class="tank-scale">
                                <span class="scale-mark">100</span>
                                <span class="scale-mark">75</span>
                                <span class="scale-mark">50</span>
                                <span class="scale-mark">25</span>
                                <span class="scale-mark">0</span>
                            </div>
                        </div>
                    </div>
                    <div class="tank-info-stack">
                        <div class="tank-percent" id="supplyPercent">78<span>%</span></div>
                        <div class="tank-detail">
                            <div class="tank-detail-label">Capacity</div>
                            <div class="tank-detail-value">1,200 L</div>
                        </div>
                        <div class="tank-detail">
                            <div class="tank-detail-label">Current Volume</div>
                            <div class="tank-detail-value" id="supplyVolume">936 L</div>
                        </div>
                        <div class="tank-detail">
                            <div class="tank-detail-label">Temperature</div>
                            <div class="tank-detail-value">24.3 ¬∞C</div>
                        </div>
                    </div>
                </div>
                <div class="tank-status-bar">
                    <div class="tank-status">
                        <span class="status-dot online"></span>
                        <span>Sensor Online</span>
                    </div>
                    <div class="tank-updated">Updated 5s ago</div>
                </div>
            </div>

            <!-- Consumption Tank -->
            <div class="tank-card consumption">
                <div class="tank-card-header">
                    <div class="tank-card-title">Consumption Tank</div>
                    <div class="tank-card-badge">TINACO</div>
                </div>
                <div class="tank-visual-area">
                    <div class="tank-container">
                        <div class="tank-cap">
                            <div class="tank-cap-pipe"></div>
                        </div>
                        <div class="tank-body">
                            <div class="tank-water" id="consumptionWater" style="height: 54%;">
                                <div class="bubble" style="width:5px;height:5px;left:30%;bottom:12%;animation-delay:0.5s;"></div>
                                <div class="bubble" style="width:4px;height:4px;left:60%;bottom:6%;animation-delay:1.8s;"></div>
                                <div class="bubble" style="width:6px;height:6px;left:45%;bottom:18%;animation-delay:3s;"></div>
                                <div class="bubble" style="width:3px;height:3px;left:70%;bottom:4%;animation-delay:2.2s;"></div>
                            </div>
                            <div class="tank-scale">
                                <span class="scale-mark">100</span>
                                <span class="scale-mark">75</span>
                                <span class="scale-mark">50</span>
                                <span class="scale-mark">25</span>
                                <span class="scale-mark">0</span>
                            </div>
                        </div>
                    </div>
                    <div class="tank-info-stack">
                        <div class="tank-percent" id="consumptionPercent">54<span>%</span></div>
                        <div class="tank-detail">
                            <div class="tank-detail-label">Capacity</div>
                            <div class="tank-detail-value">600 L</div>
                        </div>
                        <div class="tank-detail">
                            <div class="tank-detail-label">Current Volume</div>
                            <div class="tank-detail-value" id="consumptionVolume">324 L</div>
                        </div>
                        <div class="tank-detail">
                            <div class="tank-detail-label">Temperature</div>
                            <div class="tank-detail-value">25.1 ¬∞C</div>
                        </div>
                    </div>
                </div>
                <div class="tank-status-bar">
                    <div class="tank-status">
                        <span class="status-dot online"></span>
                        <span>Sensor Online</span>
                    </div>
                    <div class="tank-updated">Updated 5s ago</div>
                </div>
            </div>
        </div>

        <!-- Bottom Row: Chart + Activity -->
        <div class="bottom-row">
            <div class="chart-card">
                <div class="card-header">
                    <div class="card-title">Water Level History</div>
                    <div class="card-tabs">
                        <button class="card-tab active" onclick="setChartRange(this, '24h')">24H</button>
                        <button class="card-tab" onclick="setChartRange(this, '7d')">7D</button>
                        <button class="card-tab" onclick="setChartRange(this, '30d')">30D</button>
                    </div>
                </div>
                <div class="chart-area">
                    <svg viewBox="0 0 700 200" preserveAspectRatio="none" id="chartSvg">
                        <defs>
                            <linearGradient id="supplyGradient" x1="0" y1="0" x2="0" y2="1">
                                <stop offset="0%" stop-color="rgba(79,172,254,0.4)"/>
                                <stop offset="100%" stop-color="rgba(79,172,254,0)"/>
                            </linearGradient>
                            <linearGradient id="consumptionGradient" x1="0" y1="0" x2="0" y2="1">
                                <stop offset="0%" stop-color="rgba(102,126,234,0.4)"/>
                                <stop offset="100%" stop-color="rgba(102,126,234,0)"/>
                            </linearGradient>
                        </defs>
                        <!-- Grid lines -->
                        <line class="chart-grid-line" x1="50" y1="20" x2="690" y2="20"/>
                        <line class="chart-grid-line" x1="50" y1="65" x2="690" y2="65"/>
                        <line class="chart-grid-line" x1="50" y1="110" x2="690" y2="110"/>
                        <line class="chart-grid-line" x1="50" y1="155" x2="690" y2="155"/>
                        <!-- Y-axis labels -->
                        <text class="chart-label" x="40" y="24" text-anchor="end">100%</text>
                        <text class="chart-label" x="40" y="69" text-anchor="end">75%</text>
                        <text class="chart-label" x="40" y="114" text-anchor="end">50%</text>
                        <text class="chart-label" x="40" y="159" text-anchor="end">25%</text>
                        <!-- X-axis labels -->
                        <text class="chart-label" x="90" y="190">00:00</text>
                        <text class="chart-label" x="197" y="190">04:00</text>
                        <text class="chart-label" x="304" y="190">08:00</text>
                        <text class="chart-label" x="411" y="190">12:00</text>
                        <text class="chart-label" x="518" y="190">16:00</text>
                        <text class="chart-label" x="625" y="190">20:00</text>
                        <!-- Supply area fill -->
                        <path class="chart-area-supply" d="M90,56 L143,50 L197,54 L250,48 L304,38 L357,42 L411,52 L464,44 L518,36 L571,40 L625,30 L678,34 L678,175 L90,175 Z" style="animation: fadeUp 1s ease-out both; animation-delay: 0.5s;"/>
                        <!-- Consumption area fill -->
                        <path class="chart-area-consumption" d="M90,80 L143,88 L197,75 L250,90 L304,95 L357,84 L411,100 L464,88 L518,82 L571,92 L625,78 L678,85 L678,175 L90,175 Z" style="animation: fadeUp 1s ease-out both; animation-delay: 0.6s;"/>
                        <!-- Supply line -->
                        <polyline class="chart-line-supply" points="90,56 143,50 197,54 250,48 304,38 357,42 411,52 464,44 518,36 571,40 625,30 678,34" style="stroke-dasharray: 1000; animation: chart-draw 2s ease-out both; animation-delay: 0.5s;"/>
                        <!-- Consumption line -->
                        <polyline class="chart-line-consumption" points="90,80 143,88 197,75 250,90 304,95 357,84 411,100 464,88 518,82 571,92 625,78 678,85" style="stroke-dasharray: 1000; animation: chart-draw 2s ease-out both; animation-delay: 0.7s;"/>
                        <!-- Data dots -->
                        <circle class="chart-dot supply" cx="90" cy="56"/><circle class="chart-dot supply" cx="197" cy="54"/>
                        <circle class="chart-dot supply" cx="304" cy="38"/><circle class="chart-dot supply" cx="411" cy="52"/>
                        <circle class="chart-dot supply" cx="518" cy="36"/><circle class="chart-dot supply" cx="625" cy="30"/>
                        <circle class="chart-dot supply" cx="678" cy="34"/>
                        <circle class="chart-dot consumption" cx="90" cy="80"/><circle class="chart-dot consumption" cx="197" cy="75"/>
                        <circle class="chart-dot consumption" cx="304" cy="95"/><circle class="chart-dot consumption" cx="411" cy="100"/>
                        <circle class="chart-dot consumption" cx="518" cy="82"/><circle class="chart-dot consumption" cx="625" cy="78"/>
                        <circle class="chart-dot consumption" cx="678" cy="85"/>
                    </svg>
                </div>
                <div class="chart-legend">
                    <div class="legend-item"><span class="legend-dot supply"></span> Supply (Cisterna)</div>
                    <div class="legend-item"><span class="legend-dot consumption"></span> Consumption (Tinaco)</div>
                </div>
            </div>

            <!-- Activity Log -->
            <div class="activity-card">
                <div class="card-header">
                    <div class="card-title">Activity Log</div>
                </div>
                <div class="activity-list">
                    <div class="activity-item">
                        <div class="activity-icon fill">üíß</div>
                        <div class="activity-text"><strong>Supply tank</strong> refill started ‚Äî pump activated</div>
                        <div class="activity-time">2m ago</div>
                    </div>
                    <div class="activity-item">
                        <div class="activity-icon drain">üìâ</div>
                        <div class="activity-text"><strong>Consumption tank</strong> dropped below 60% threshold</div>
                        <div class="activity-time">15m ago</div>
                    </div>
                    <div class="activity-item">
                        <div class="activity-icon system">‚úÖ</div>
                        <div class="activity-text"><strong>System check</strong> ‚Äî all sensors responding normally</div>
                        <div class="activity-time">32m ago</div>
                    </div>
                    <div class="activity-item">
                        <div class="activity-icon alert">‚ö†Ô∏è</div>
                        <div class="activity-text"><strong>High usage</strong> detected ‚Äî 12% above daily average</div>
                        <div class="activity-time">1h ago</div>
                    </div>
                    <div class="activity-item">
                        <div class="activity-icon fill">üíß</div>
                        <div class="activity-text"><strong>Supply tank</strong> reached 85% ‚Äî pump stopped</div>
                        <div class="activity-time">2h ago</div>
                    </div>
                    <div class="activity-item">
                        <div class="activity-icon system">‚úÖ</div>
                        <div class="activity-text"><strong>Scheduled backup</strong> completed successfully</div>
                        <div class="activity-time">3h ago</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // =====================================================
        // SUPABASE AUTH (same pattern as index.html)
        // =====================================================
        const SUPABASE_URL = 'https://mcwsdinbxwfomkgtolhf.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1jd3NkaW5ieHdmb21rZ3RvbGhmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI2NjU2MzcsImV4cCI6MjA3ODI0MTYzN30.rjJpb2OQRui-1uIsn2VwE_zX-I5V2CKgM3MveZSXxW4';

        let supabaseClient = null;
        let currentUser = null;
        let authInitialized = false;

        function initSupabase() {
            if (window.supabase && window.supabase.createClient) {
                supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
                return true;
            }
            return false;
        }

        function toggleUserDropdown() {
            document.getElementById('navDropdownMenu').classList.toggle('show');
        }
        function closeUserDropdown() {
            document.getElementById('navDropdownMenu').classList.remove('show');
        }
        document.addEventListener('click', function(e) {
            const dropdown = document.getElementById('navUserDropdown');
            if (dropdown && !dropdown.contains(e.target)) closeUserDropdown();
        });

        function updateUserInfo(user) {
            if (user && user.email) {
                const navAuth = document.getElementById('navAuthButtons');
                const navUser = document.getElementById('navUserDropdown');
                const navName = document.getElementById('navUserName');
                if (navAuth) navAuth.style.cssText = 'display: none !important;';
                if (navUser) navUser.style.cssText = 'display: flex !important; position: relative;';
                if (navName) navName.textContent = user.email.split('@')[0];
            }
        }
        function hideUserInfo() {
            const navAuth = document.getElementById('navAuthButtons');
            const navUser = document.getElementById('navUserDropdown');
            if (navAuth) navAuth.style.cssText = 'display: flex !important;';
            if (navUser) navUser.style.cssText = 'display: none !important;';
        }

        async function handleLogout() {
            try {
                await supabaseClient.auth.signOut();
                currentUser = null;
                hideUserInfo();
                window.location.href = 'index.html';
            } catch (error) {
                console.error('Logout error:', error);
            }
        }

        // =====================================================
        // LIVE CLOCK
        // =====================================================
        function updateClock() {
            const now = new Date();
            const opts = {
                timeZone: 'America/Santo_Domingo',
                hour: '2-digit', minute: '2-digit', second: '2-digit',
                hour12: true
            };
            document.getElementById('liveTime').textContent = now.toLocaleTimeString('en-US', opts);
        }

        // =====================================================
        // SIMULATED TANK DATA (replace with real MQTT/sensor data)
        // =====================================================
        let supplyLevel = 78;
        let consumptionLevel = 54;

        function simulateTankData() {
            // Small random fluctuations
            supplyLevel = Math.max(5, Math.min(98, supplyLevel + (Math.random() - 0.45) * 2));
            consumptionLevel = Math.max(5, Math.min(98, consumptionLevel + (Math.random() - 0.55) * 2));

            const sP = Math.round(supplyLevel);
            const cP = Math.round(consumptionLevel);

            // Update tank water levels
            document.getElementById('supplyWater').style.height = sP + '%';
            document.getElementById('consumptionWater').style.height = cP + '%';

            // Update percentages
            document.getElementById('supplyPercent').innerHTML = sP + '<span>%</span>';
            document.getElementById('consumptionPercent').innerHTML = cP + '<span>%</span>';

            // Update stat cards
            document.getElementById('statSupply').innerHTML = sP + '<span>%</span>';
            document.getElementById('statConsumption').innerHTML = cP + '<span>%</span>';

            // Update volumes
            document.getElementById('supplyVolume').textContent = Math.round(sP / 100 * 1200) + ' L';
            document.getElementById('consumptionVolume').textContent = Math.round(cP / 100 * 600) + ' L';

            // Update "Updated Xs ago" text
            document.querySelectorAll('.tank-updated').forEach(el => {
                el.textContent = 'Updated just now';
            });
        }

        // Chart tab switching
        function setChartRange(btn, range) {
            document.querySelectorAll('.card-tab').forEach(t => t.classList.remove('active'));
            btn.classList.add('active');
            // In production, this would fetch new chart data for the selected range
        }

        // =====================================================
        // INIT
        // =====================================================
        window.onload = function() {
            if (!initSupabase()) {
                console.error('Failed to initialize Supabase');
                return;
            }

            // Single source of truth for auth
            supabaseClient.auth.onAuthStateChange((event, session) => {
                if (session && session.user) {
                    currentUser = session.user;
                    updateUserInfo(session.user);
                } else if (event === 'SIGNED_OUT') {
                    currentUser = null;
                    hideUserInfo();
                }
                authInitialized = true;
            });

            // Fallback if onAuthStateChange doesn't fire
            setTimeout(async () => {
                if (!authInitialized) {
                    try {
                        const { data: { session } } = await supabaseClient.auth.getSession();
                        if (session && session.user) {
                            currentUser = session.user;
                            updateUserInfo(session.user);
                        } else {
                            hideUserInfo();
                        }
                    } catch (e) {
                        hideUserInfo();
                    }
                    authInitialized = true;
                }
            }, 3000);

            // Start live clock
            updateClock();
            setInterval(updateClock, 1000);

            // Simulate tank data updates every 5 seconds
            setTimeout(simulateTankData, 2000);
            setInterval(simulateTankData, 5000);
        };
    </script>
</body>
</html>
